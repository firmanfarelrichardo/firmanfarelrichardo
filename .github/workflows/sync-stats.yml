name: Sync GitHub Stats

on:
  schedule:
    - cron: '0 0 * * 0'
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  sync-stats:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Get GitHub stats
      id: github-stats
      uses: actions/github-script@v6
      with:
        script: |
          const response = await github.rest.users.getAuthenticated();
          const stats = {
            public_repos: response.data.public_repos,
            followers: response.data.followers,
            following: response.data.following,
            created_at: response.data.created_at,
            updated_at: new Date().toISOString()
          };
          console.log('GitHub Stats:', stats);
          return stats;

    - name: Log stats update
      run: |
        echo "GitHub stats synced at $(date)" >> .github-stats-log.txt
        
    - name: Commit stats log
      run: |
        git config --global user.email "action@github.com"
        git config --global user.name "GitHub Action"
        git add .github-stats-log.txt || true
        git commit -m "stats: update github statistics [skip ci]" || true
        git push || true
